---
title: "プロジェクト管理AIエージェントを作った1週間：失敗から学んだJSON Schemaの価値"
date: 2025-01-17
categories: ["knowledge-management"]
tags: ["ai-agent", "chatgpt", "json-schema", "project-management", "vibe-coding"]
learned_date: 2025-01-15
draft: false
---

> 学習日: 2025-01-15 / 公開日: 2025-01-17

## はじめに

会社で年明け早々AIエージェント作りに時間を使ってしまった。

「時間を使ってしまった」というと無駄に聞こえるけど、これは後で非常に時間とエネルギーの節約になると確信している。

年明け1日目から、自分が関わっているプロジェクトの進捗状況を管理するAIエージェントを作り始めた。目的は、自分の仕事を一箇所に全部キャプチャーして、エージェントと相談しながら次のアクションを決めたり、メールのドラフトを作ったりすること。

## 第1段階：自然言語での対話 → MDファイル管理

最初は自然言語で自分のプロジェクトの進捗について相談し始めたら、非常にうまくいった。

継続性を持たせるために、話した内容をMarkdownファイルに残してアップデートしていくようなエージェントを作った。

会社のAIエージェントはまだフォルダ操作などが許可されていないので、以下のような運用にした:

1. プロジェクト名、今やっていること、仕事の責任範囲などをざっと書いたMDファイルをアップロード
2. 「今日こんなことがあった」と自然な会話で話す
3. エージェントがTaskやProgressを勝手にキャプチャーしてMDにアップデートしてくれる

### 感動した瞬間

このアプローチが素晴らしく機能した:

- 「ミーティングの中で誰それがこういうConcernを出した」→「Escalationのメールをドラフトしましょうか？Riskを追加しましょうか？」
- 「誰それとミーティングすることになった」→「ミーティングInviteを書きましょうか？」

素晴らしすぎる・・・

## 問題1：MDファイルが大きくなると破綻する

しかし、MDファイルが大きくなってくると問題が発生した:

- **思ったところと違うところにアップデート**されてしまう
- **全文を出してと言っても出してくれなくなった**

会社のPCではGitがまだ使えない（Company Portalにはあったけど、自分の部署は対象外。どうにか許可を取って申請したい）ので、自分で一生懸命VSCodeで差分を見ながらコピペしていた。

何より問題だったのは、**AIがヒューリスティックにやっているので、MDファイルのアップデート方法に一貫性がない**こと。

## 第2段階：JSON差分 + Pythonでの更新

ヒューリスティックにやっていると仕事にムラがあるから、もう少しルールをちゃんとしようと考えた。

ChatGPTに「プロジェクトの進捗状況などの差分をJSON形式でもらって、Pythonで更新していくのはどうでしょう？」と聞いたら、「いいですね」と返ってきた。

### 仕組み

- AIにJSON形式で差分を出してもらう
- Pythonスクリプトで該当箇所を更新
- 差分を差し込むためのマシンリーダブルなアンカー `<!-- Project:XXX -->` を挿入（ObsidianのReadモードだとコメントアウトで見えなくなる）

その日はなんとなくうまくいった。

## 問題2：ヒューリスティックの限界

しかし、次の日にエージェントが出してきたJSONファイルは、うまくいかなかった。

### 失敗例1: 変数名が毎回違う

微妙に変数名が違っていた:
- ある日: `Content`
- 次の日: `TEXT`
などなど

### 失敗例2: スキーマの想像が毎回違う

実際には複数のスキーマが必要なファイルだったのに、一部だけを見てヒューリスティックにスキーマを想像し、**毎回違うスキーマで出してきた**。

例えば:
- Domain/Area of responsibilities
- Domainに関するKnowledge section
- Projectの中に入れ子でTask, Progress, Risk/Issuesなど
- 全体のUpdate Log

これらすべてが1つのMDファイルに含まれているのに、ChatGPTは全てをProjectのSchemaと判断して、ProjectのSchemaを他のセクションにも無理やり当てはめたり、そこから逆算して書いてるPythonもぐちゃぐちゃになり、どっちを直しても、何回直しても、一箇所直ると、別の場所が壊れるみたいなカオスな状況になった。

### 失敗例3: アンカーの位置ミス

次のセクションのアンカー `<!-- Project:XXX -->` の直前に挿入してくれたのだが、**実はHuman Readableな見出しやコンテンツがその前にあって、その後に挿入されてしまった**。

例:
```markdown
## Project1
Project1はほにゃらら
<!-- Project1 -->
### Tasks 
<!-- Project1:TaskList -->
- Task 1
- Task 2

## Project2
Project2はほにゃらら
[新しいタスクがここに挿入されてしまう]
<!-- Project2 -->
### Tasks
<!-- Project2:TaskList -->
```

本当は Project1のTask2の直後に挿入してほしかったのに、次のセクションの中に入ってしまう。

### 気づき

これはヒューリスティックに頼っていたらダメだ。やっぱりちゃんとDefineして渡さなきゃダメだ。

MDファイルのフォーマット、およびDiffのJSON Schema、またPython Scriptを作り直してもらったが、曖昧なデータを元に推論でやってるので**何回やってもうまくいかない**。

## 転機：適切な質問をする

行き詰まって、ChatGPTに聞いた:

> 自分のProjectの内容を多少構造化されているものの、自由な文で書いてあるMDを会社のCo Pilot Agentにヒューリスティックにアップデートしてもらってたのですが、内容が増えるにつれて混乱が生じてきて、難しくなってきました。　それで、<!-- proj:xxx> みたいなアンカーをつけて、マシンにわかりやすくして、Agentの会話でIdentifyされた新しいタスクなら当該プロジェクトの新しいタスクの最終行に追加みたいな試みを始めました。差分だけJSONでもらって、PythonでInsertやChangeなど試みたのですが、全体の構造化が甘いのか、何度やってもうまくいきません。なので、もうMDファイルに挿入訂正というよりは、JSONで全てのアイテムを保持して、<!-- proj:xxx>のタスクだけを、日付順に全表示みたいなデータベースみたいな運用できないかなと思っているのですが、何かいいアイデアありますか？　会社のAgentには制約があるので、毎回、今までのデータを渡して、前回からの進捗をDiscussし、新しいアクションタスクなど提案してもらい、データベースに追加したいです。

すると、ChatGPTは言った:

> いい方向転換だと思います。**「MDを更新し続ける」**は、途中から必ず“文章の意味解釈＋挿入位置推定”になって壊れます。
会社Agentの制約があるなら、発想を **「人間向けはMD、機械向けはJSON（真実のソース）」** に切るのが一番安定します。

**途中から必ず壊れます!! じゃあ最初からそちらを提案してくれれば良かったのに!!**

でも、これが学びだった。**やっぱり良い答えを引き出せるような質問をしていかないとダメなんだ**。

## 第3段階：Robust JSON Schema + Single Source of Truth

今、ChatGPTと一緒にRobustなJSON Schemaを作り始めているところ。

### 新しいアーキテクチャ

1. **JSON Schemaをビシッと決める**
2. **今までのプロジェクトファイルをその型に合わせてCSVで渡す**
3. **JSONにして、それをSingle Source of Truthとして運用開始**
4. **アップデートや変更をJSONで渡してもらう**
5. **元のJSONと合わせて、閲覧用MDファイルにするPythonを書く**

### 追加アイデア

名前をFull NameでCaptureして人物録も作れるといいね。「何月何日、何の件で話した人」みたいに。

今のプロジェクトは登場人物が多すぎて、名前が全然覚えられないので...

## まとめ：遠回りから学んだこと

大分遠回りしてしまったが、一昨日くらいまでJSONのなんたるかも分かっていなかったことを考えれば、毎日新しいことを学べているということで良しとしよう。

### 学んだこと

1. **ヒューリスティックには限界がある**
   - AIに「いい感じにやって」と頼むと、最初は非常にいい感じだが、だんだん壊れてくる　（これは去年Gemini CLIに1000個くらいのファイルアップデートをお願いした時も同じ経験をした）
   - 一貫性が必要な場合は、明確なルールが必要

2. **適切な質問が重要**
   - AIは聞かれたことに集中した答えをする
   - 質問力を鍛えていきたい。もうちょっとOpen Endな聞き方にすればいいのかな？
   
3. **構造化データの価値**
   - Human ReadableなMarkdownは人間には読みやすいが、機械的な操作には向かない
   - JSON SchemaでしっかりDefineすることで、一貫性のある運用が可能になる

4. **Single Source of Truthの重要性**
   - データの真実は1箇所に
   - 閲覧用の形式は、そこから生成する
   - アンカーの採番もAIがやってたら適当になるので、Pythonにさせた方がいいでしょうとのこと

これからJSON Schemaをビシッと決めて、プロジェクト管理エージェントを完成させる。

まだ道半ばだけど、このプロセス自体が良い学びになっている。

---

**関連記事:**
- [Claude Codeと一緒にLearning in Publicブログを構築した](/posts/2025-01-15-building-blog-with-claude/)
